#!/bin/bash

[ ! -z "$ESHOP_FACT_BASEDIR" ] || \
    ESHOP_FACT_BASEDIR=$(dirname "$BASH_SOURCE")

ESHOP_FACT_BASEDIR=$(readlink -fn $ESHOP_FACT_BASEDIR)

[ ! -z "$ESHOP_SOURCE_PATH" ] || \
    ESHOP_SOURCE_PATH=$(readlink -fn "$ESHOP_FACT_BASEDIR/../../source/")

[ ! -z "$ESHOP_BOOTSTRAP_PATH" ] || \
    ESHOP_BOOTSTRAP_PATH=$(readlink -fn "$ESHOP_SOURCE_PATH/bootstrap.php")

[ ! -z "$ESHOP_VENDOR_PATH" ] || \
    ESHOP_VENDOR_PATH=$(readlink -fn "$ESHOP_SOURCE_PATH/../vendor/")

[ ! -z "$ESHOP_VENDOR_BIN_PATH" ] || \
    ESHOP_VENDOR_BIN_PATH=$(readlink -fn "$ESHOP_VENDOR_PATH/bin")

[ ! -z "$ESHOP_VENDOR_NAME" ] || \
    ESHOP_VENDOR_NAME="oxid-esales"

[ ! -z "$ESHOP_OXID_VENDOR_PATH" ] || \
    ESHOP_OXID_VENDOR_PATH=$(readlink -fn "$ESHOP_VENDOR_PATH/$ESHOP_VENDOR_NAME")

[ ! -z "$ESHOP_PE_ROOT_PATH" ] || \
    ESHOP_PE_ROOT_PATH=$(readlink -fn "$ESHOP_VENDOR_PATH/$ESHOP_VENDOR_NAME/oxideshop-pe")

[ ! -z "$ESHOP_EE_ROOT_PATH" ] || \
    ESHOP_EE_ROOT_PATH=$(readlink -fn "$ESHOP_VENDOR_PATH/$ESHOP_VENDOR_NAME/oxideshop-ee")

[ ! -z "$ESHOP_GET_EDITION_SCRIPT_PATH" ] || \
    ESHOP_GET_EDITION_SCRIPT_PATH=$(readlink -fn "$ESHOP_FACT_BASEDIR/oe-edition_facts")

[ ! -z "$ESHOP_EDITION" ] || \
    ESHOP_EDITION=$(ESHOP_BOOTSTRAP_PATH="$ESHOP_BOOTSTRAP_PATH" php $ESHOP_GET_EDITION_SCRIPT_PATH)

if [ ! -z "$VERBOSE" ] || [ ! -z "$ESHOP_VERBOSE_FACTS" ] ; then
    echo "Variables from: $(basename $BASH_SOURCE)"
    echo "ESHOP_FACT_BASEDIR: $ESHOP_FACT_BASEDIR"
    echo "ESHOP_SOURCE_PATH: $ESHOP_SOURCE_PATH"
    echo "ESHOP_BOOTSTRAP_PATH: $ESHOP_BOOTSTRAP_PATH"
    echo "ESHOP_VENDOR_PATH: $ESHOP_VENDOR_PATH"
    echo "ESHOP_VENDOR_BIN_PATH: $ESHOP_VENDOR_BIN_PATH"
    echo "ESHOP_VENDOR_NAME: $ESHOP_VENDOR_NAME"
    echo "ESHOP_OXID_VENDOR_PATH: $ESHOP_OXID_VENDOR_PATH"
    echo "ESHOP_PE_ROOT_PATH: $ESHOP_PE_ROOT_PATH"
    echo "ESHOP_EE_ROOT_PATH: $ESHOP_EE_ROOT_PATH"
    echo "ESHOP_GET_EDITION_SCRIPT_PATH: $ESHOP_GET_EDITION_SCRIPT_PATH"
    echo "ESHOP_EDITION: $ESHOP_EDITION"
    echo ""
fi

export ESHOP_FACTS=1
[ ! -z "$VERBOSE" ] && export VERBOSE="$VERBOSE"

export ESHOP_SOURCE_PATH="$ESHOP_SOURCE_PATH"
export ESHOP_BOOTSTRAP_PATH="$ESHOP_BOOTSTRAP_PATH"
export ESHOP_VENDOR_PATH="$ESHOP_VENDOR_PATH"
export ESHOP_VENDOR_BIN_PATH="$ESHOP_VENDOR_BIN_PATH"
export ESHOP_VENDOR_NAME="$ESHOP_VENDOR_NAME"
export ESHOP_OXID_VENDOR_PATH="$ESHOP_OXID_VENDOR_PATH"
export ESHOP_PE_ROOT_PATH="$ESHOP_PE_ROOT_PATH"
export ESHOP_EE_ROOT_PATH="$ESHOP_EE_ROOT_PATH"
export ESHOP_GET_EDITION_SCRIPT_PATH="$ESHOP_GET_EDITION_SCRIPT_PATH"
export ESHOP_EDITION="$ESHOP_EDITION"

if [ ! -z "$1" ] ; then
    "$ESHOP_VENDOR_BIN_PATH/$@"
fi
